<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Library Score</title>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
            <form class="form" action="libscore.html" method="GET">
                <label class="h1">Library ranking</label>
                <div class="form-group">
                    <label for="">Library 1</label>
                    <input id="input1" class="text" type="text" name="lib1" minlength="3"><br><br>
                    <label for="">Library 2</label>
                    <input id="input2" class="" type="text" name="lib2" minlength="3"><br><br>
                    <div id="append">
                        
                    </div>
                </div>
                <button id="new" class="btn" type="button">New Library</button>
                <input id="submit" class="btn btn-primary" type="submit">
            </form>
            </div>
            
                <div class="col-lg-2">
                    <h4 id="lib1Label">Library 1</h4>
                    <p id="library1"></p>
                </div>
            
            <div class="col-lg-2">
                <h4 id="lib2Label">Library 2</h4>
                <p id="library2"></p>
            </div>
            <div class="col-lg-2">
                <h4 id="lib3Label"></h4>
                <p id="library3"></p>
            </div>
            <div class="col-lg-2">
                <h4 id="lib4Label"></h4>
                <p id="library4"></p>
            </div>
            <div class="col-lg-1">
                <h4 id="lib5Label"></h4>
                <p id="library5"></p>
            </div>
        </div>

            
        </div>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

            <script>
                $(document).ready(ready);

                var appended = 2;
                var url = 'https://api.npms.io/v2/package/';
                var input;
                var input1;
                var input2;
                var input3;
                var input4;
                var input5;
                var lib1;
                var lib2;
                var lib3;
                var lib4;
                var lib5;
                

                function ready() {
                    $('#new').click(newLibrary);
                   try {
                    $('.form').submit(setTimeout(Input(), 200));
                   }
                   catch {
                        console.log('Fail');
                        
                   }
                }
               
                     function newLibrary() {
                        ++appended;
                     if (appended <= 5) { $("#append").append('<label>Library ' +appended + ' '+' </label>')
                         $("#append").append("<input type='text' name='lib" + appended + "'><br><br>")
                         $("#lib" + appended + "Label").html('Library ' + appended);
                         event.preventDefault();
                         }
                         else {
                         if (appended == 6) {
                         $("#append").append("<h4>Maximum limit reached</h4>");
                         }
                         }
                    
                    }
                         
                function Input() {
                    console.log(appended);
                   //takes query strings
                    input = window.location.href;
                    input= input.split('=',6);
                    
                   // takes them out of the original array
                    input1 = input[1];
                    input2 = input[2];
                    //splits them up at the & too
                    input1 = input1.split('&',5);
                    input2 = input2.split('&',5);

                    //Specifies what part of the array the value is in
                    input1 = input1[0];
                    input2 = input2[0];
                    submit1();
                    submit2();
                    
                    if (appended == 3) {
                        console.log('3 run');
                        input3 = input[3];
                        input3 = input3.split('&',5);
                        input3 = input3[0];
                        submit3();
                    }
                    else if (appended == 4) {
                        console.log('4 run');
                        input3 = input[3];
                        input3 = input3.split('&',5);
                        input3 = input3[0];

                        input4 = input[4];
                        input4 = input4.split('&',5);
                        input4 = input4[0];
                        submit3();
                        submit4();
                    }
                    else if (appended == 5) {
                        console.log('5 run');
                        input3 = input[3];
                        input3 = input3.split('&',5);
                        input3 = input3[0];
                        input4 = input[4];
                        input4 = input4.split('&',5);
                        input4 = input4[0];
                        input5 = input[5];
                        input5 = input5.split('&',5);
                        input5 = input5[0];
                        submit3();
                        submit4();
                        submit5();
                    }
                    
                }
                
               

               
                
               
            

                function submit1() {
                    var library1;
                    var lib1Orig;
                    $.ajax({
                    url: url + input1,
                    type: 'GET',
                    async: false,
                    crossDomain: true,
                    dataType: 'json',
                    success: function(library1Data) {
                        library1 = library1Data;
                        //library = JSON.stringify(library1);
                        lib1Orig = library1.score.final;
                        lib1 = String(lib1Orig);
                        lib1 = lib1.substring(2,4);
                        displayInput();
                    },
                    error: function(xhr, status) {
                        console.log("error");
                    }
                    });
                }
                
                function submit2() {
                    var library2;
                    var lib2Orig;
                   
                    $.ajax({
                        url: url + input2,
                        type: 'GET',
                        async: false,
                        crossDomain: true,
                        dataType: 'json',
                        success: function(library2Data) {
                            library2 = library2Data;
                            //library = JSON.stringify(library1);
                            lib2Orig = library2.score.final;
                            lib2 = String(lib2Orig);
                            lib2 = lib2.substring(2,4);
                            displayInput();
                        },
                        error: function(xhr, status) {
                            console.log("error");
                        }
                        });
                }
                function submit3() {
                var library3;
                var lib2Orig;

                $.ajax({
                url: url + input3,
                type: 'GET',
                async: false,
                crossDomain: true,
                dataType: 'json',
                success: function(library3Data) {
                library3 = library3Data;
                //library = JSON.stringify(library1);
                lib3Orig = library3.score.final;
                lib3 = String(lib3Orig);
                lib3 = lib3.substring(2,4);
                console.log("ajaxed 3")
                //lib1 = (lib1Orig);
                displayInput();
                },
                error: function(xhr, status) {
                console.log("error");
                }
                });
                }
                
                function submit4() {
                var library4;
                var lib4Orig;

                $.ajax({
                url: url + input4,
                type: 'GET',
                async: false,
                crossDomain: true,
                dataType: 'json',
                success: function(library4Data) {
                library4 = library4Data;
                lib4Orig = library4.score.final;
                lib4 = String(lib4Orig);
                lib4 = lib4.substring(2,4);
                displayInput();
                },
                error: function(xhr, status) {
                console.log("error");
                }
                });
                }

                function submit5() {
                var library5;
                var lib5Orig;

                $.ajax({
                url: url + input5,
                type: 'GET',
                async: false,
                crossDomain: true,
                dataType: 'json',
                success: function(library5Data) {
                library5 = library5Data;
                //library = JSON.stringify(library1);
                lib5Orig = library5.score.final;
                lib5 = String(lib5Orig);
                lib5 = lib5.substring(2,4);
                //lib1 = (lib1Orig);
                displayInput();
                },
                error: function(xhr, status) {
                console.log("error");
                }
                });
                }


                function displayInput() {
                    $('#lib1Label').html(input1);
                    $('#library1').html(lib1 + '%');
                    $('#lib2Label').html(input2);
                    $('#library2').html(lib2 + '%');
                    if (typeof lib3 === 'string' || lib3 instanceof String) {
                        console.log('3displayed');
                        $('#lib3Label').html(input3);
                        $('#library3').html(lib3 + '%');
                    }
                    else if (typeof lib4 === 'string' || lib4 instanceof String) {
                        $('#lib4Label').html(input4);
                        $('#library4').html(lib4 + '%');
                    }
                    else if (typeof lib5 === 'string' || lib5 instanceof String) {
                        $('#lib5Label').html(input5);
                         $('#library5').html(lib5 + '%');
                    }
                   event.preventDefault();
                }
            </script>
    </body>
</html>